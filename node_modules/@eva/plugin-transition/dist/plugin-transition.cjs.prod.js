"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("@tweenjs/tween.js"),n=require("@eva/eva.js"),e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)};function i(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}var o={linear:t.Easing.Linear.None,"ease-in":t.Easing.Quadratic.In,"ease-out":t.Easing.Quadratic.Out,"ease-in-out":t.Easing.Quadratic.InOut,"bounce-in":t.Easing.Bounce.In,"bounce-out":t.Easing.Bounce.Out,"bounce-in-out":t.Easing.Bounce.InOut,none:function(t){return~~t}},r=function(){function n(t,n){this.tweens=[],this.timelines=[],this.finishCount=0,this.callbacks=new Map,this.objectCache={},this.currIteration=0,this.timelines=t,this.tweenGroup=n}return n.prototype.on=function(t,n){this.callbacks[t]||this.callbacks.set(t,[]),this.callbacks.get(t).push(n)},n.prototype.emit=function(t){var n=this.callbacks.get(t);n&&n.length&&n.forEach((function(t){return t()}))},n.prototype.checkFinish=function(){if(++this.finishCount==this.tweens.length)if(++this.currIteration==this.iteration)this.emit("finish");else{if(this.stoped)return;this.start()}},n.prototype.getObjectCache=function(t,n){var e=""+t.gameObject.id+t.name;if(this.objectCache[e]||(this.objectCache[e]={}),this.objectCache[e][n])return this.objectCache[e][n];for(var i=n.split("."),o=i.length-1,r=t,s=0;s<o;s++)r=r[i[s]];return this.objectCache[e][n]={property:r,key:i[o]},this.objectCache[e][n]},n.prototype.doAnim=function(t){var n=t.component,e=t.name,i=t.value,o=this.getObjectCache(n,e);o.property[o.key]=i},n.prototype.init=function(){var n,e=this;this.checkFinishFunc=this.checkFinish.bind(this),this.timelines.forEach((function(i,r){for(var s=0;s<i.values.length-1;s++){var a=i.values[s],u=i.values[s+1],h=new t.Tween({value:a.value},e.tweenGroup).to({value:u.value}).duration(u.time-a.time).easing(o[a.tween]).onUpdate((function(t){e.doAnim({component:i.component,name:i.name,value:t.value})}));0===s?e.tweens[r]=h:n.chain(h),n=h}n&&n.onComplete((function(){return e.checkFinishFunc()}))}))},n.prototype.play=function(t,n){void 0===t&&(t=1),this.currentTime=n,this.stoped=!1,this.start(),this.currIteration=0,this.iteration=t},n.prototype.start=function(){var t=this;this.finishCount=0,this.tweens.length=0,this.init(),this.tweens.forEach((function(n){return n.start(t.currentTime)}))},n.prototype.pause=function(){var t=this;this.tweens.forEach((function(n){return n.pause(t.currentTime)}))},n.prototype.resume=function(){var t=this;this.tweens.forEach((function(n){return n.resume(t.currentTime)}))},n.prototype.stop=function(){this.stoped=!0,this.tweens.forEach((function(t){return t.stop()}))},n.prototype.destroy=function(){this.stop(),this.tweens=null,this.timelines=null,this.objectCache=null,this.callbacks.clear(),this.callbacks=null},n}(),s=function(n){function e(){var t=null!==n&&n.apply(this,arguments)||this;return t.animations={},t.group={},t.currentTime=0,t.needPlay=[],t}return i(e,n),e.prototype.init=function(n){var e=(void 0===n?{group:{}}:n).group;this.group=e,this.tweenGroup=new t.Group},e.prototype.awake=function(){for(var t in this.group)this.newAnimation(t)},e.prototype.play=function(t,n){t||(t=Object.keys(this.group)[0]),t&&!this.animations[t]&&this.group[t]&&this.newAnimation(t),t&&this.animations[t]&&this.needPlay.push({name:t,iteration:n})},e.prototype.stop=function(t){if(t)this.animations[t].stop();else for(var n in this.animations)this.animations[n].stop()},e.prototype.onPause=function(){for(var t in this.animations)this.animations[t].pause()},e.prototype.onResume=function(){for(var t in this.animations)this.animations[t].resume()},e.prototype.onDestroy=function(){for(var t in this.animations)this.animations[t].destroy();this.tweenGroup.removeAll(),this.tweenGroup=null,this.group=null,this.animations=null,this.removeAllListeners()},e.prototype.update=function(t){var n,e;for(var i in this.currentTime=t.time,this.animations)this.animations[i].currentTime=t.time;this.tweenGroup.update(t.time);try{for(var o=function(t){var n="function"==typeof Symbol&&t[Symbol.iterator],e=0;return n?n.call(t):{next:function(){return t&&e>=t.length&&(t=void 0),{value:t&&t[e++],done:!t}}}}(this.needPlay),r=o.next();!r.done;r=o.next()){var s=r.value;this.animations[s.name].play(s.iteration,this.currentTime)}}catch(t){n={error:t}}finally{try{r&&!r.done&&(e=o.return)&&e.call(o)}finally{if(n)throw n.error}}this.needPlay.length=0},e.prototype.newAnimation=function(t){var n=this,e=new r(this.group[t],this.tweenGroup);e.on("finish",(function(){return n.emit("finish",t)})),this.animations[t]=e},e.componentName="Transition",e}(n.Component),a=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.name="transition",n}return i(n,t),n.systemName="transition",n}(n.System);exports.Transition=s,exports.TransitionSystem=a;
